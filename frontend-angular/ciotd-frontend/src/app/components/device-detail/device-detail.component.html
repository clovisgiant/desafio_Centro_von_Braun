<div class="loading" *ngIf="loading">Carregando...</div>

<div class="error" *ngIf="error && !loading">
  <p>{{ error }}</p>
  <button (click)="back()">Voltar</button>
</div>

<div class="container" *ngIf="!loading && !error && device">
  <div class="back-button">
    <button (click)="back()">← Voltar</button>
  </div>

  <div class="device-info">
    <h1>{{ device.description }}</h1>
    <p class="device-id">ID: {{ device.identifier }}</p>
    <p class="device-manufacturer">
      Fabricante: {{ device.manufacturer }}
    </p>
    <p class="device-url">
      URL: {{ device.url }}
    </p>
    <p class="device-commands">
      Comandos disponíveis: {{ device.commands.length }}
    </p>
  </div>

  <div class="commands-available" *ngIf="device.commands && device.commands.length > 0">
    <h2>Comandos Disponíveis</h2>
    <div class="commands-list">
      <div *ngFor="let cmd of device.commands" class="command-item" (click)="selectCommand(cmd)">
        <strong>{{ cmd.operation }}</strong>
        <p>{{ cmd.description }}</p>
        <small>Resultado: {{ cmd.result }}</small>
      </div>
    </div>
  </div>

  <div class="command-panel">
    <h2>Executar Comando</h2>

    <div class="form-group">
      <label>Comando:</label>
      <input
        [(ngModel)]="command"
        type="text"
        placeholder="Selecione um comando acima"
        readonly
      />
    </div>

    <!-- Parâmetros dinâmicos se o comando tiver definição -->
    <div *ngIf="getCommandParameters().length > 0" class="parameters-section">
      <h3>Parâmetros:</h3>
      <div *ngFor="let param of getCommandParameters()" class="form-group">
        <label>{{ param.name }}:</label>
        <input
          [(ngModel)]="commandParams[param.name]"
          type="text"
          [placeholder]="param.description || 'Digite o valor'"
        />
        <small *ngIf="param.description" class="param-hint">{{ param.description }}</small>
      </div>
    </div>

    <!-- Fallback para comandos sem definição de parâmetros -->
    <div *ngIf="command && getCommandParameters().length === 0" class="form-group">
      <label>Parâmetros (separados por espaço):</label>
      <input
        [(ngModel)]="parameters"
        type="text"
        placeholder="ex: param1 param2 param3"
      />
    </div>

    <button
      class="execute-btn"
      (click)="executeCommand()"
      [disabled]="!command || !device || executing"
      [title]="!device ? 'Aguarde o carregamento do dispositivo' : (!command ? 'Selecione um comando' : 'Executar comando')"
    >
      {{ executing ? 'Executando...' : 'Executar' }}
    </button>
  </div>

  <div *ngIf="result" class="result success">
    <h3>Resultado:</h3>
    <p>{{ result }}</p>
  </div>

  <div *ngIf="resultError" class="result error">
    <h3>Erro:</h3>
    <p>{{ resultError }}</p>
  </div>
</div>